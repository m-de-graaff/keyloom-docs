---
title: Frequently Asked Questions
description: Common questions and answers about Keyloom
---

import { Callout } from 'fumadocs-ui/components/callout'

# Frequently Asked Questions

Common questions and answers about using Keyloom.

## General Questions

### What is Keyloom?

Keyloom is a modern, type-safe authentication library for JavaScript applications. It provides secure session management, OAuth integration, and role-based access control with a focus on developer experience and security.

### How is Keyloom different from NextAuth.js?

Keyloom offers several advantages:

- **Type-safe by default** - Full TypeScript support throughout
- **Modern architecture** - Built for App Router and edge runtime
- **Flexible adapters** - Easy database integration
- **Built-in RBAC** - Role-based access control out of the box
- **Security-first** - CSRF protection, rate limiting, secure defaults
- **Framework agnostic** - Core library works with any framework

### Is Keyloom production-ready?

Keyloom is actively developed and used in production applications. However, it's still evolving, so we recommend:

- Testing thoroughly in your specific use case
- Following security best practices
- Keeping up with updates
- Reporting any issues you encounter

### What databases are supported?

Currently supported:
- **PostgreSQL** (via Prisma adapter)
- **MySQL** (via Prisma adapter)
- **SQLite** (via Prisma adapter)
- **Memory** (for development/testing)

Planned support:
- MongoDB
- Redis
- Custom adapters

## Installation & Setup

### How do I get started with Keyloom?

1. Install the packages:
   ```bash
   npm install @keyloom/core @keyloom/nextjs
   ```

2. Create a configuration file:
   ```typescript
   // keyloom.config.ts
   export default {
     adapter: memoryAdapter(), // Use prismaAdapter in production
     session: { strategy: "database", ttlMinutes: 60 },
     secrets: { authSecret: process.env.AUTH_SECRET! },
   };
   ```

3. Set up API routes and middleware (see [Getting Started](/getting-started))

### What environment variables do I need?

Required:
```bash
AUTH_SECRET=your-super-secret-key-here
DATABASE_URL=postgresql://user:pass@host:5432/db
```

Optional:
```bash
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
```

### How do I generate an AUTH_SECRET?

```bash
# Using OpenSSL
openssl rand -base64 32

# Using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Online generator
# Visit: https://generate-secret.vercel.app/32
```

## Authentication

### How do I implement login/logout?

```typescript
// Login
import { login } from "@keyloom/core";

const { user, session } = await login(
  { email: "user@example.com", password: "password" },
  { adapter, hasher: argon2idHasher }
);

// Logout
import { logout } from "@keyloom/core";

await logout(sessionId, adapter);
```

### How do I protect routes?

```typescript
// middleware.ts
import { createAuthMiddleware } from "@keyloom/nextjs";
import config from "./keyloom.config";

export default createAuthMiddleware(config, {
  protectedPaths: ["/dashboard", "/profile"],
  publicPaths: ["/", "/login", "/register"],
});
```

### How do I get the current user?

```typescript
// Server Component
import { getCurrentUser } from "@keyloom/nextjs";

export default async function Page() {
  const user = await getCurrentUser();
  
  if (!user) {
    return <div>Please log in</div>;
  }
  
  return <div>Hello {user.email}!</div>;
}

// API Route
import { getCurrentSession } from "@keyloom/core";

export async function GET(request: Request) {
  const sessionId = getSessionIdFromCookie(request);
  const { user } = await getCurrentSession(sessionId, adapter);
  
  return Response.json({ user });
}
```

## OAuth Providers

### How do I add OAuth providers?

1. Install the providers package:
   ```bash
   npm install @keyloom/providers
   ```

2. Configure providers:
   ```typescript
   import github from "@keyloom/providers/github";
   
   export default {
     providers: [
       github({
         clientId: process.env.GITHUB_CLIENT_ID!,
         clientSecret: process.env.GITHUB_CLIENT_SECRET!,
       }),
     ],
     // ... other config
   };
   ```

3. Set up OAuth routes (handled automatically by Keyloom)

### Which OAuth providers are supported?

Currently supported:
- GitHub
- Google
- Discord

Planned support:
- Microsoft
- Apple
- Twitter/X
- LinkedIn
- Custom providers

### How do I create a custom OAuth provider?

```typescript
import type { OAuthProvider } from "@keyloom/core";

function customProvider(opts: {
  clientId: string;
  clientSecret: string;
}): OAuthProvider & { clientId: string; clientSecret: string } {
  return {
    id: "custom",
    authorization: {
      url: "https://provider.com/oauth/authorize",
      params: { scope: "read:user email" },
    },
    token: {
      url: "https://provider.com/oauth/token",
      style: "json",
    },
    userinfo: {
      url: "https://api.provider.com/user",
      map: (raw) => ({
        id: String(raw.id),
        email: raw.email ?? null,
        name: raw.name ?? null,
        image: raw.avatar_url ?? null,
      }),
    },
    scopes: ["read:user", "email"],
    clientId: opts.clientId,
    clientSecret: opts.clientSecret,
  };
}
```

## Database & Adapters

### How do I set up the database schema?

Using Prisma:

1. Install dependencies:
   ```bash
   npm install @keyloom/adapters prisma @prisma/client
   ```

2. Add schema to `schema.prisma`:
   ```prisma
   // See full schema in Adapters documentation
   model User {
     id            String    @id @default(cuid())
     email         String?   @unique
     emailVerified DateTime?
     // ... other fields
   }
   ```

3. Run migrations:
   ```bash
   npx prisma migrate dev
   ```

### Can I use my existing user table?

Yes! Keyloom adapters are flexible. You can:

1. **Extend existing schema** - Add required Keyloom fields
2. **Create custom adapter** - Map your schema to Keyloom interface
3. **Use views** - Create database views that match Keyloom schema

### How do I handle database migrations?

```bash
# Development
npx prisma migrate dev --name add_keyloom_auth

# Production
npx prisma migrate deploy
```

For custom adapters, implement your own migration strategy.

## Security

### Is Keyloom secure?

Keyloom follows security best practices:

- **Argon2id password hashing** - Industry standard
- **CSRF protection** - Double-submit cookie pattern
- **Rate limiting** - Built-in protection against brute force
- **Secure sessions** - Database-backed with expiration
- **HTTPS enforcement** - Secure cookies in production
- **Input validation** - All inputs are validated

### How do I enable CSRF protection?

CSRF protection is enabled by default. Ensure you:

1. Include CSRF token in forms:
   ```typescript
   const csrfToken = await getCsrfToken();
   ```

2. Send token in requests:
   ```typescript
   fetch("/api/auth/login", {
     method: "POST",
     headers: {
       "Content-Type": "application/json",
       "X-Keyloom-CSRF": csrfToken,
     },
     body: JSON.stringify({ email, password }),
   });
   ```

### How do I configure rate limiting?

```typescript
// Custom rate limiting
import { rateLimit } from "@keyloom/core";

const isAllowed = rateLimit.rateLimit(`login:${ip}`, {
  capacity: 5,        // 5 attempts
  refillPerSec: 0.1,  // Refill 1 every 10 seconds
});

if (!isAllowed) {
  return Response.json({ error: "rate_limited" }, { status: 429 });
}
```

## Performance

### How do I optimize performance?

1. **Database optimization**:
   ```sql
   -- Add indexes for common queries
   CREATE INDEX idx_sessions_user_id ON sessions(user_id);
   CREATE INDEX idx_sessions_expires_at ON sessions(expires_at);
   ```

2. **Connection pooling**:
   ```typescript
   const prisma = new PrismaClient({
     datasources: {
       db: {
         url: process.env.DATABASE_URL + "?connection_limit=10",
       },
     },
   });
   ```

3. **Session cleanup**:
   ```typescript
   // Clean up expired sessions
   setInterval(async () => {
     await adapter.deleteExpiredSessions();
   }, 60 * 60 * 1000); // Every hour
   ```

### How do I handle high traffic?

- Use **Redis** for session storage
- Implement **horizontal scaling**
- Use **CDN** for static assets
- Enable **database read replicas**
- Consider **edge runtime** deployment

## Troubleshooting

### Sessions are not persisting

Check:
- Cookie settings (domain, secure, sameSite)
- `AUTH_SECRET` is set correctly
- Database connection is working
- Session expiration settings

### CSRF token errors

Ensure:
- CSRF token is included in requests
- Cookie and header tokens match
- Cookies are enabled in browser
- Correct header name (`X-Keyloom-CSRF`)

### OAuth login not working

Verify:
- Client ID and secret are correct
- Redirect URIs match exactly
- OAuth app is configured properly
- Environment variables are set

### Database connection issues

Check:
- `DATABASE_URL` format is correct
- Database server is running
- Network connectivity
- Connection pool settings

### TypeScript errors

Common solutions:
- Update to latest TypeScript version
- Check type imports
- Verify configuration types
- Clear TypeScript cache

## Migration

### How do I migrate from NextAuth.js?

1. **Install Keyloom**:
   ```bash
   npm install @keyloom/core @keyloom/nextjs
   ```

2. **Update configuration**:
   ```typescript
   // Before (NextAuth.js)
   export default NextAuth({
     providers: [GithubProvider({ ... })],
   });
   
   // After (Keyloom)
   export const { GET, POST } = createNextHandler({
     providers: [github({ ... })],
   });
   ```

3. **Update database schema** (see migration guide)

4. **Update client code**:
   ```typescript
   // Before
   import { useSession } from "next-auth/react";
   
   // After
   import { useUser } from "@keyloom/nextjs";
   ```

### Can I migrate gradually?

Yes! You can run both systems in parallel:

1. Set up Keyloom on new routes
2. Gradually migrate existing functionality
3. Update client code incrementally
4. Remove NextAuth.js when complete

## Support

### Where can I get help?

- **Documentation** - Comprehensive guides and API reference
- **GitHub Issues** - Bug reports and feature requests
- **GitHub Discussions** - Questions and community support
- **Discord** - Real-time community chat (coming soon)

### How do I report a bug?

1. Check existing issues first
2. Create a minimal reproduction
3. Include environment details
4. Use the issue template
5. Add relevant labels

### How do I request a feature?

1. Search existing feature requests
2. Describe the use case clearly
3. Provide implementation ideas
4. Consider contributing the feature

### Is commercial support available?

Commercial support and consulting services are planned. Contact us at support@keyloom.dev for enterprise needs.

## Contributing

### How can I contribute?

- Report bugs and issues
- Suggest new features
- Improve documentation
- Submit code contributions
- Help others in discussions

See our [Contributing Guide](/contributing) for detailed information.

### What skills do I need to contribute?

- **TypeScript/JavaScript** - Core development
- **React/Next.js** - Frontend integrations
- **Database knowledge** - Adapter development
- **Security expertise** - Security features
- **Technical writing** - Documentation

All skill levels are welcome! Start with documentation or small bug fixes.
