---
title: Migrate from Auth0
description: Complete step-by-step guide to migrate from Auth0 to Keyloom with user data preservation.
---

import { Steps, Step } from "fumadocs-ui/components/steps";
import { Callout } from "fumadocs-ui/components/callout";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";

# Migrate from Auth0

This guide walks you through migrating from Auth0 to Keyloom while preserving your user data and maintaining authentication functionality.

<Callout type="info">
  Migration typically takes 2-4 hours for most applications. Plan for a
  maintenance window if you need zero downtime.
</Callout>

## Pre-Migration Checklist

Before starting the migration:

- [ ] **Backup Auth0 data**: Export users, applications, and configurations
- [ ] **Inventory integrations**: List all applications using Auth0
- [ ] **Document custom rules/actions**: Note any Auth0 Rules or Actions
- [ ] **Plan downtime**: Schedule maintenance window if needed
- [ ] **Test environment**: Set up staging environment for testing

## Migration Overview

The migration process involves:

1. **Setup Keyloom** alongside Auth0 (parallel operation)
2. **Export user data** from Auth0
3. **Import users** into Keyloom database
4. **Update applications** to use Keyloom
5. **Test thoroughly** before switching over
6. **Gradual cutover** or maintenance window switch

<Steps>
<Step>

### Install and Configure Keyloom

First, set up Keyloom in your application:

```bash
npm install @keyloom/core @keyloom/nextjs @keyloom/providers @keyloom/adapters
```

Initialize Keyloom with similar providers to your Auth0 setup:

```bash
npx keyloom init --session database --adapter prisma --providers github,google,microsoft --rbac
```

Configure your providers in `keyloom.config.ts`:

```typescript title="keyloom.config.ts"
import { defineKeyloom } from "@keyloom/core";
import { prismaAdapter } from "@keyloom/adapters";
import github from "@keyloom/providers/github";
import google from "@keyloom/providers/google";
import microsoft from "@keyloom/providers/microsoft";
import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();

export default defineKeyloom({
  adapter: prismaAdapter(prisma),
  baseUrl: process.env.NEXT_PUBLIC_APP_URL!,
  session: { strategy: "database" },
  providers: [
    github({
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    }),
    google({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    microsoft({
      clientId: process.env.MICROSOFT_CLIENT_ID!,
      clientSecret: process.env.MICROSOFT_CLIENT_SECRET!,
    }),
  ],
});
```

</Step>

<Step>

### Export Users from Auth0

Use Auth0's Management API to export user data:

<Tabs>
<Tab value="script" label="Node.js Script">

```javascript title="scripts/export-auth0-users.js"
const { ManagementClient } = require("auth0");

const management = new ManagementClient({
  domain: process.env.AUTH0_DOMAIN,
  clientId: process.env.AUTH0_CLIENT_ID,
  clientSecret: process.env.AUTH0_CLIENT_SECRET,
  scope: "read:users read:user_idp_tokens",
});

async function exportUsers() {
  let users = [];
  let page = 0;
  const perPage = 100;

  while (true) {
    const batch = await management.getUsers({
      page,
      per_page: perPage,
      include_totals: true,
    });

    users = users.concat(batch.users);

    if (batch.users.length < perPage) break;
    page++;
  }

  console.log(`Exported ${users.length} users`);

  // Transform Auth0 user format to Keyloom format
  const keyloomUsers = users.map(transformAuth0User);

  require("fs").writeFileSync(
    "auth0-users-export.json",
    JSON.stringify(keyloomUsers, null, 2)
  );
}

function transformAuth0User(auth0User) {
  return {
    id: auth0User.user_id,
    email: auth0User.email,
    emailVerified: auth0User.email_verified ? new Date() : null,
    name: auth0User.name || auth0User.nickname,
    image: auth0User.picture,
    createdAt: new Date(auth0User.created_at),
    updatedAt: new Date(auth0User.updated_at),
    // Map Auth0 identities to Keyloom accounts
    accounts:
      auth0User.identities?.map((identity) => ({
        provider: mapAuth0Provider(identity.provider),
        providerAccountId: identity.user_id,
        type: "oauth",
        // Note: tokens will need to be re-obtained
      })) || [],
    // Map Auth0 app_metadata to Keyloom format
    metadata: {
      roles: auth0User.app_metadata?.roles || [],
      permissions: auth0User.app_metadata?.permissions || [],
      ...auth0User.user_metadata,
    },
  };
}

function mapAuth0Provider(auth0Provider) {
  const providerMap = {
    "google-oauth2": "google",
    github: "github",
    microsoft: "microsoft",
    auth0: "auth0", // For database connections
    // Add other provider mappings as needed
  };
  return providerMap[auth0Provider] || auth0Provider;
}

exportUsers().catch(console.error);
```

</Tab>

<Tab value="cli" label="Auth0 CLI">

```bash
# Install Auth0 CLI
npm install -g auth0-cli

# Login to Auth0
auth0 login

# Export users
auth0 users export --format json --output auth0-users.json

# You'll need to transform the format manually or with a script
```

</Tab>
</Tabs>

</Step>

<Step>

### Import Users into Keyloom

Create a script to import the transformed user data:

```javascript title="scripts/import-users-to-keyloom.js"
const { PrismaClient } = require("@prisma/client");
const bcrypt = require("bcryptjs");
const fs = require("fs");

const prisma = new PrismaClient();

async function importUsers() {
  const users = JSON.parse(fs.readFileSync("auth0-users-export.json", "utf8"));

  console.log(`Importing ${users.length} users...`);

  for (const user of users) {
    try {
      // Create user
      const createdUser = await prisma.user.create({
        data: {
          id: user.id,
          email: user.email,
          emailVerified: user.emailVerified,
          name: user.name,
          image: user.image,
          createdAt: user.createdAt,
          updatedAt: user.updatedAt,
        },
      });

      // Create accounts (OAuth connections)
      for (const account of user.accounts) {
        await prisma.account.create({
          data: {
            userId: createdUser.id,
            type: account.type,
            provider: account.provider,
            providerAccountId: account.providerAccountId,
            // Note: Access tokens will need to be re-obtained
          },
        });
      }

      // Handle password users (Auth0 database connections)
      if (user.password) {
        // Note: Auth0 password hashes cannot be directly imported
        // Users will need to reset passwords or use gradual migration
        await prisma.credential.create({
          data: {
            userId: createdUser.id,
            hashedPassword: await bcrypt.hash(
              "TEMP_PASSWORD_RESET_REQUIRED",
              12
            ),
            // Flag for password reset requirement
            requiresReset: true,
          },
        });
      }

      console.log(`Imported user: ${user.email}`);
    } catch (error) {
      console.error(`Failed to import user ${user.email}:`, error.message);
    }
  }

  console.log("User import completed");
}

importUsers()
  .catch(console.error)
  .finally(() => prisma.$disconnect());
```

</Step>

<Step>

### Handle Password Migration

Auth0 password hashes cannot be directly imported. Choose a migration strategy:

<Tabs>
<Tab value="reset" label="Password Reset (Recommended)">

```javascript title="scripts/send-password-reset-emails.js"
// Send password reset emails to all migrated users
async function sendPasswordResetEmails() {
  const users = await prisma.user.findMany({
    where: {
      credentials: {
        requiresReset: true,
      },
    },
  });

  for (const user of users) {
    if (user.email) {
      await sendPasswordResetEmail(user.email);
      console.log(`Sent password reset to: ${user.email}`);
    }
  }
}
```

</Tab>

<Tab value="gradual" label="Gradual Migration">

```javascript title="middleware/auth0-fallback.js"
// Fallback to Auth0 for users who haven't migrated yet
export async function authMiddleware(req, res, next) {
  const { email, password } = req.body;

  // Try Keyloom first
  const user = await authenticateWithKeyloom(email, password);
  if (user) return next();

  // Fallback to Auth0
  try {
    const auth0User = await authenticateWithAuth0(email, password);
    if (auth0User) {
      // Migrate user on successful Auth0 login
      await migrateUserFromAuth0(auth0User, password);
      return next();
    }
  } catch (error) {
    console.error("Auth0 fallback failed:", error);
  }

  return res.status(401).json({ error: "Authentication failed" });
}
```

</Tab>
</Tabs>

</Step>

<Step>

### Update Application Code

Replace Auth0 SDK calls with Keyloom:

<Tabs>
<Tab value="nextjs" label="Next.js">

```typescript title="Before (Auth0)"
// pages/api/auth/[...auth0].js
import { handleAuth } from "@auth0/nextjs-auth0";
export default handleAuth();

// pages/profile.js
import { useUser } from "@auth0/nextjs-auth0/client";

export default function Profile() {
  const { user, error, isLoading } = useUser();
  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>{error.message}</div>;
  return user ? <div>Hello {user.name}</div> : <div>Not logged in</div>;
}
```

```typescript title="After (Keyloom)"
// app/api/auth/[...keyloom]/route.ts
import { createNextHandler } from "@keyloom/nextjs";
import config from "@/keyloom.config";
export const { GET, POST } = createNextHandler(config);

// app/profile/page.tsx
import { getSession } from "@keyloom/nextjs";
import config from "@/keyloom.config";

export default async function Profile() {
  const session = await getSession(config);
  return session?.user ? (
    <div>Hello {session.user.name}</div>
  ) : (
    <div>Not logged in</div>
  );
}
```

</Tab>

<Tab value="react" label="React SPA">

```typescript title="Before (Auth0)"
import { Auth0Provider, useAuth0 } from "@auth0/auth0-react";

function App() {
  return (
    <Auth0Provider
      domain="your-domain.auth0.com"
      clientId="your-client-id"
      redirectUri={window.location.origin}
    >
      <Profile />
    </Auth0Provider>
  );
}

function Profile() {
  const { user, isAuthenticated, loginWithRedirect } = useAuth0();
  // ... component logic
}
```

```typescript title="After (Keyloom)"
// Use Keyloom with your preferred React auth library
// or implement custom hooks for your SPA setup
import { createAuthClient } from "@keyloom/client";

const auth = createAuthClient({
  baseUrl: process.env.REACT_APP_API_URL,
});

function Profile() {
  const [user, setUser] = useState(null);

  useEffect(() => {
    auth.getSession().then(setUser);
  }, []);

  // ... component logic
}
```

</Tab>
</Tabs>

</Step>

<Step>

### Migrate Auth0 Rules/Actions

Convert Auth0 Rules and Actions to Keyloom hooks:

<Tabs>
<Tab value="rules" label="Auth0 Rules">

```javascript title="Auth0 Rule Example"
function addCustomClaims(user, context, callback) {
  const namespace = "https://yourdomain.com/";
  context.idToken[namespace + "roles"] = user.app_metadata.roles || [];
  context.idToken[namespace + "permissions"] =
    user.app_metadata.permissions || [];
  callback(null, user, context);
}
```

</Tab>

<Tab value="hooks" label="Keyloom Hooks">

```typescript title="keyloom.config.ts"
export default defineKeyloom({
  // ... other config
  hooks: {
    async beforeSignIn(user, account, profile) {
      // Add custom logic before sign in
      console.log("User signing in:", user.email);
      return true; // Allow sign in
    },

    async afterSignIn(user, account, profile, isNewUser) {
      // Add roles and permissions to user
      if (isNewUser) {
        await assignDefaultRoles(user.id);
      }

      // Log sign in event
      await logAuditEvent("sign_in", user.id);
    },

    async beforeSignOut(user) {
      // Custom logic before sign out
      await logAuditEvent("sign_out", user.id);
    },
  },
});

async function assignDefaultRoles(userId: string) {
  // Implement your role assignment logic
  await prisma.userRole.create({
    data: {
      userId,
      roleId: "default-user-role",
    },
  });
}
```

</Tab>
</Tabs>

</Step>

<Step>

### Test the Migration

Thoroughly test your migration:

```typescript title="tests/migration.test.ts"
import { test, expect } from "@playwright/test";

test.describe("Auth0 to Keyloom Migration", () => {
  test("existing users can sign in", async ({ page }) => {
    await page.goto("/login");

    // Test OAuth sign in
    await page.click('[data-testid="google-signin"]');
    // ... test OAuth flow

    // Test email/password sign in (after password reset)
    await page.fill('[name="email"]', "test@example.com");
    await page.fill('[name="password"]', "new-password");
    await page.click('[type="submit"]');

    await expect(page.locator('[data-testid="user-name"]')).toBeVisible();
  });

  test("user data is preserved", async ({ page }) => {
    // Test that user metadata, roles, etc. are preserved
    await signIn(page, "test@example.com");

    const userData = await page.evaluate(() => {
      return fetch("/api/user").then((r) => r.json());
    });

    expect(userData.roles).toContain("admin");
    expect(userData.metadata.department).toBe("engineering");
  });
});
```

</Step>

<Step>

### Go Live

Choose your cutover strategy:

<Tabs>
<Tab value="maintenance" label="Maintenance Window">

1. **Schedule downtime** (typically 1-2 hours)
2. **Stop Auth0 traffic** by updating DNS or load balancer
3. **Switch to Keyloom** endpoints
4. **Test critical flows** quickly
5. **Monitor for issues** and have rollback plan ready

</Tab>

<Tab value="gradual" label="Gradual Migration">

1. **Deploy Keyloom alongside Auth0**
2. **Route new users to Keyloom**
3. **Migrate existing users on login** (lazy migration)
4. **Gradually increase Keyloom traffic**
5. **Decommission Auth0** once all users migrated

</Tab>
</Tabs>

</Step>
</Steps>

## Common Migration Challenges

### Password Hash Incompatibility

**Problem**: Auth0 password hashes cannot be imported directly.

**Solutions**:

- Force password reset for all users
- Implement gradual migration with Auth0 fallback
- Use magic link authentication temporarily

### Custom Claims and Metadata

**Problem**: Auth0 custom claims need to be mapped to Keyloom format.

**Solution**:

```typescript
// Map Auth0 app_metadata to Keyloom user metadata
const keyloomUser = {
  ...user,
  metadata: {
    roles: auth0User.app_metadata?.roles || [],
    permissions: auth0User.app_metadata?.permissions || [],
    department: auth0User.user_metadata?.department,
  },
};
```

### Social Connection Tokens

**Problem**: OAuth tokens from Auth0 cannot be transferred.

**Solution**: Users need to re-authenticate with social providers to get fresh tokens.

### Multi-Factor Authentication

**Problem**: MFA settings don't transfer from Auth0.

**Solution**:

- Reset MFA for all users
- Implement gradual MFA re-enrollment
- Consider temporary MFA bypass during migration

## Post-Migration Tasks

After successful migration:

- [ ] **Monitor authentication metrics** for issues
- [ ] **Update documentation** with new authentication flows
- [ ] **Train support team** on Keyloom troubleshooting
- [ ] **Set up monitoring** and alerting for Keyloom
- [ ] **Plan Auth0 decommissioning** after stable period
- [ ] **Update backup and disaster recovery** procedures

## Rollback Plan

If issues arise during migration:

1. **Immediate**: Switch DNS/load balancer back to Auth0
2. **Database**: Restore from pre-migration backup if needed
3. **Applications**: Revert code changes to Auth0 integration
4. **Communication**: Notify users of temporary service restoration

<Callout type="warning">
  Always test your rollback plan in a staging environment before going live.
</Callout>

## Cost Savings Calculator

Estimate your savings after migrating from Auth0:

```
Monthly Auth0 Cost = Monthly Active Users × $0.023
Annual Auth0 Cost = Monthly Auth0 Cost × 12

Example for 10,000 MAU:
- Auth0: $230/month = $2,760/year
- Keyloom: $0/year (hosting costs only)
- Annual Savings: $2,760
```

## Support and Resources

- **Migration Support**: Join our Discord for migration assistance
- **Professional Services**: Contact us for hands-on migration help
- **Documentation**: Comprehensive guides for all migration scenarios
- **Community**: Learn from others who have migrated successfully
