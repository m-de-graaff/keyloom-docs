---
title: Next.js Integration
description: Overview of the Keyloom Next.js integration - route handlers, middleware, sessions, and edge compatibility.
---

# Next.js Integration

This guide covers how to use Keyloom with Next.js, including route handlers, middleware, session reading on the server, and edge compatibility.

## Packages

- `@keyloom/nextjs` - framework bindings for Next.js
- `@keyloom/core` - core engine and config

## Quick start

1) Install packages and create `keyloom.config.ts` (see Installation)
2) Add an auth handler route under `app/api/auth/[...keyloom]/route.ts`
3) Add middleware for route protection

```ts title="app/api/auth/[...keyloom]/route.ts"
import { createNextHandler } from "@keyloom/nextjs";
import config from "@/keyloom.config";

export const { GET, POST } = createNextHandler(config);
```

```ts title="middleware.ts"
import { createAuthMiddleware } from "@keyloom/nextjs/middleware";
import config from "@/keyloom.config";

export default createAuthMiddleware(config, {
  publicRoutes: ["/", "/sign-in"],
});

export const config = {
  matcher: ["/((?!_next|.*\\.(?:ico|png|jpg|svg|css|js|map)).*)"],
};
```

## Built-in routes

When you export `{ GET, POST }` from `createNextHandler`, the following endpoints are available under your auth route (by default `/api/auth`):

- `GET /api/auth/session` - get current session
- `POST /api/auth/signin/:provider` - start OAuth login
- `GET /api/auth/callback/:provider` - OAuth callback
- `POST /api/auth/logout` - end session
- `GET /api/auth/jwks` - JWKS for JWT verification

See the Handler reference for full schemas and examples.

## App Router vs Pages Router

- App Router is fully supported with Route Handlers.
- Pages Router can use API routes: `pages/api/auth/[...keyloom].ts` exporting a default handler from `createNextApiHandler`.

```ts title="pages/api/auth/[...keyloom].ts"
import { createNextApiHandler } from "@keyloom/nextjs/pages";
import config from "@/keyloom.config";

export default createNextApiHandler(config);
```

## Edge compatibility

- The middleware and session verification work on Edge runtime when your configuration and adapter are edge-safe. Use the memory adapter or a compatible KV/HTTP adapter on edge.

## Reading the session on the server

Use the server utilities to read the session in server components, actions, or route handlers.

```ts title="app/dashboard/page.tsx"
import { getServerSession } from "@keyloom/nextjs";
import config from "@/keyloom.config";

export default async function Page() {
  const session = await getServerSession(config);
  if (!session) return <Redirect href="/sign-in" />;
  return <div>Hello {session.user.name}</div>;
}
```

## Configuration overview

Pass your `defineKeyloom` config to `createNextHandler` and the middleware. Common options:

- `baseUrl` - external base URL for callbacks
- `session.strategy` - `"jwt"` or `"database"`
- `cookie` - name, path, sameSite, secure
- `providers` - OAuth/OpenID providers
- `adapter` - database adapter when using database sessions

See Configuration for the full reference.

