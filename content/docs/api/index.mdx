---
title: API Reference
description: Comprehensive API documentation for all Keyloom packages
---

import { Cards, Card } from 'fumadocs-ui/components/card'

# API Reference

Complete API documentation for all Keyloom packages.

## Package Overview

<Cards>
  <Card title="@keyloom/core" href="/api/core" description="Core authentication logic and utilities" />
  <Card title="@keyloom/nextjs" href="/api/nextjs" description="Next.js integration and middleware" />
  <Card title="@keyloom/server" href="/api/server" description="Standalone server implementation" />
  <Card title="@keyloom/adapters" href="/api/adapters" description="Database adapters (Prisma, Memory, etc.)" />
  <Card title="@keyloom/providers" href="/api/providers" description="OAuth providers (GitHub, Google, Discord)" />
  <Card title="@keyloom/cli" href="/api/cli" description="Command-line tools and utilities" />
</Cards>

## Quick Reference

### Core Functions

```typescript
import { 
  register, 
  login, 
  logout, 
  getCurrentSession,
  memoryAdapter 
} from "@keyloom/core";

// Register a new user
const { user } = await register(
  { email: "user@example.com", password: "password" },
  { adapter, hasher }
);

// Login user
const { user, session } = await login(
  { email: "user@example.com", password: "password" },
  { adapter, hasher }
);

// Get current session
const session = await getCurrentSession(sessionId, adapter);

// Logout
await logout(sessionId, adapter);
```

### CSRF Protection

```typescript
import { csrf } from "@keyloom/core";

// Issue CSRF token
const token = csrf.issueCsrfToken();

// Validate CSRF token
const isValid = csrf.validateDoubleSubmit({
  cookieToken: "token-from-cookie",
  headerToken: "token-from-header"
});
```

### Session Management

```typescript
import { newSession, serializeSessionCookie } from "@keyloom/core";

// Create new session
const session = newSession(userId, ttlMinutes);

// Serialize session cookie
const cookie = serializeSessionCookie(sessionId, {
  domain: "example.com",
  secure: true,
  sameSite: "lax"
});
```

### OAuth Flow

```typescript
import { startOAuth, completeOAuth } from "@keyloom/core";

// Start OAuth flow
const { url, state } = await startOAuth(provider, {
  redirectUri: "http://localhost:3000/auth/callback",
  scopes: ["user:email"]
});

// Complete OAuth flow
const { user, account } = await completeOAuth(
  provider,
  { code: "auth-code", state: "state-value" },
  { adapter }
);
```

## Type Definitions

### Core Types

```typescript
import type {
  User,
  Session,
  Account,
  Adapter,
  KeyloomConfig,
  LoginInput,
  RegisterInput
} from "@keyloom/core";

interface User {
  id: string;
  email: string | null;
  emailVerified: Date | null;
  name: string | null;
  image: string | null;
  createdAt: Date;
  updatedAt: Date;
}

interface Session {
  id: string;
  userId: string;
  expiresAt: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

### Configuration Types

```typescript
interface KeyloomConfig {
  baseUrl: string;
  session: {
    strategy: "database";
    ttlMinutes: number;
    rolling: boolean;
  };
  adapter: Adapter;
  providers?: OAuthProvider[];
  rbac?: { enabled: boolean };
  cookie?: {
    domain?: string;
    secure?: boolean;
    sameSite?: "lax" | "strict" | "none";
  };
  secrets: {
    authSecret: string;
  };
}
```

## Error Handling

```typescript
import { KeyloomError, ERR } from "@keyloom/core";

try {
  await login(credentials, ctx);
} catch (error) {
  if (error instanceof KeyloomError) {
    switch (error.code) {
      case ERR.USER_NOT_FOUND:
        // Handle user not found
        break;
      case ERR.INVALID_CREDENTIALS:
        // Handle invalid credentials
        break;
      case ERR.EMAIL_EXISTS:
        // Handle email already exists
        break;
    }
  }
}
```

## Constants

```typescript
import { 
  COOKIE_NAME,
  DEFAULT_SESSION_TTL_MINUTES,
  JWT_AUDIENCE,
  JWT_ISSUER 
} from "@keyloom/core";

// Default session cookie name
console.log(COOKIE_NAME); // "__keyloom_session"

// Default session TTL
console.log(DEFAULT_SESSION_TTL_MINUTES); // 60
```

## Utilities

```typescript
import { util, argon2idHasher, newId } from "@keyloom/core";

// Time utilities
const now = util.now();
const future = util.addMinutes(now, 60);

// Password hashing
const hash = await argon2idHasher.hash("password");
const isValid = await argon2idHasher.verify(hash, "password");

// ID generation
const id = newId(); // Generates a unique ID
```

## Next Steps

- [Core Package API](/api/core) - Detailed core package documentation
- [Next.js Integration](/api/nextjs) - Next.js specific APIs
- [Database Adapters](/api/adapters) - Adapter interfaces and implementations
- [OAuth Providers](/api/providers) - Provider configurations and setup
