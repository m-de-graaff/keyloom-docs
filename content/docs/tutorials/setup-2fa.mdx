---
title: Set up 2FA (TOTP)
---

import { Step, Steps } from "fumadocs-ui/components/steps";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";
import { Callout } from "fumadocs-ui/components/callout";

Enable time-based one-time passwords (TOTP) for stronger account security.

<Callout>
Two-factor setup should be available to authenticated users only. Use `guard({ visibility: 'private' })` (App Router) or an equivalent server-side check.
</Callout>

## Steps

<Steps>

### 1) Ensure API handler is set up

```ts
// Keyloom exposes /api/auth/2fa/setup and /api/auth/2fa/verify endpoints via the handler
```

### 2) Add the 2FA setup page

<Tabs>
<Tab value="app-router" title="App Router">

```tsx
// app/(auth)/setup-2fa/page.tsx
import { guard } from "@keyloom/nextjs";
import { TwoFactorSetup } from "@keyloom/ui/auth";
export const metadata = { title: "Two-factor authentication" };
export default async function Page() {
  await guard({ visibility: "private", redirectTo: "/sign-in" });
  return (
    <div className="min-h-dvh grid place-items-center p-6">
      <div className="w-full max-w-md p-6 border rounded">
        <TwoFactorSetup />
      </div>
    </div>
  );
}
```

</Tab>
<Tab value="pages-router" title="Pages Router">

```tsx
// pages/setup-2fa.tsx
import dynamic from "next/dynamic";
const TwoFactorSetup = dynamic(
  () => import("@keyloom/ui/auth").then((m) => m.TwoFactorSetup),
  { ssr: false }
);
export default function Page() {
  return (
    <div className="min-h-screen grid place-items-center p-6">
      <div className="w-full max-w-md p-6 border rounded">
        <TwoFactorSetup />
      </div>
    </div>
  );
}
```

</Tab>
</Tabs>

### 3) What the component does

- Initializes TOTP and returns QR + secret via POST /api/auth/2fa/setup
- Verifies a 6-digit code via POST /api/auth/2fa/verify to enable 2FA

</Steps>

## Troubleshooting

- Invalid code: verify device time sync; TOTP is time-based.
- 404 on setup/verify: ensure your API handler is configured.
- Access control: protect the page with `guard` to require authentication.
