---
title: Installation
---

import { Tabs, Tab } from "fumadocs-ui/components/tabs";
import { Callout } from "fumadocs-ui/components/callout";

Install Keyloom packages, set environment variables, and wire the API handler and middleware.

## Install packages

Use your preferred package manager.

```bash
# npm
npm install @keyloom/core @keyloom/nextjs @keyloom/adapters @keyloom/ui @keyloom/providers @prisma/client
```

```bash
# yarn
yarn add @keyloom/core @keyloom/nextjs @keyloom/adapters @keyloom/ui @keyloom/providers @prisma/client
```

```bash
# pnpm
pnpm add @keyloom/core @keyloom/nextjs @keyloom/adapters @keyloom/ui @keyloom/providers @prisma/client
```

## Environment

Set these in `.env.local` (preferred) or `.env`.

```bash
NEXT_PUBLIC_APP_URL=https://your-app.example.com
AUTH_SECRET=base64url-32-bytes-min
DATABASE_URL=postgres://...
# Optional provider envs
GITHUB_CLIENT_ID=...
GITHUB_CLIENT_SECRET=...
```

<Callout>
  AUTH_SECRET must be base64url (A–Z a–z 0–9 - _) and decode to at least 32
  bytes. Run `keyloom doctor --fix` to auto-generate a valid secret.
</Callout>

## Configuration

```ts
// keyloom.config.ts
import { PrismaAdapter } from "@keyloom/adapters";
import { PrismaClient } from "@prisma/client";
import { github } from "@keyloom/providers";

const db = new PrismaClient();
export default {
  baseUrl: process.env.NEXT_PUBLIC_APP_URL!,
  adapter: PrismaAdapter(db),
  // Use database sessions by default; switch to 'jwt' if you prefer stateless
  // sessionStrategy: 'database' | 'jwt',
  providers: [
    github({
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    }),
  ],
  cookie: { sameSite: "lax" },
  secrets: { authSecret: process.env.AUTH_SECRET! },
};
```

## API handler

<Tabs>
<Tab value="app-router" title="App Router">

```ts
// app/api/auth/[[...keyloom]]/route.ts
import { createNextHandler } from "@keyloom/nextjs";
import config from "@/keyloom.config";
export const { GET, POST } = createNextHandler(config);
```

</Tab>
<Tab value="pages-router" title="Pages Router">

```ts
// pages/api/auth/[...keyloom].ts
import { createPagesApiHandler } from "@keyloom/nextjs";
import config from "@/keyloom.config";
export default createPagesApiHandler(config);
```

</Tab>
</Tabs>

## Middleware (recommended)

```ts
// middleware.ts
import { createAuthMiddleware } from "@keyloom/nextjs/middleware";
import config from "@/keyloom.config";
export default createAuthMiddleware(config);
```

## Next steps

- Validate setup with `keyloom doctor` (or `--fix`)
- Scaffold pages with `keyloom scaffold`
- Test `GET /api/auth/session` and `GET /api/auth/csrf`
