---
title: GitLab Provider
description: Configure GitLab OAuth with Keyloom for GitLab.com and self-hosted GitLab instances.
---

import { Callout } from "fumadocs-ui/components/callout";
import { Steps } from "fumadocs-ui/components/steps";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";

# GitLab Provider

The GitLab provider enables OAuth authentication using GitLab accounts. Works with both GitLab.com and self-hosted GitLab instances, perfect for developer tools and applications targeting GitLab users.

## Features

- **GitLab.com Support**: Authenticate with GitLab.com accounts
- **Self-Hosted GitLab**: Support for private GitLab instances
- **API Access**: Access GitLab API with user tokens
- **Scope Control**: Fine-grained permission control
- **Enterprise Ready**: Works with GitLab Enterprise Edition

## Setup

<Steps>
<Step>

### Create GitLab Application

<Tabs>
<Tab value="gitlab-com" label="GitLab.com">

1. Go to [GitLab.com](https://gitlab.com/)
2. Navigate to your profile → "Preferences" → "Applications"
3. Click "Add new application"
4. Configure your application:
   - **Name**: Your application name
   - **Redirect URI**: `https://yourdomain.com/api/auth/callback/gitlab`
   - **Scopes**: Select required scopes (see below)

</Tab>

<Tab value="self-hosted" label="Self-Hosted GitLab">

1. Go to your GitLab instance
2. Navigate to Admin Area → "Applications" (admin) or User Settings → "Applications" (user)
3. Click "Add new application"
4. Configure your application:
   - **Name**: Your application name
   - **Redirect URI**: `https://yourdomain.com/api/auth/callback/gitlab`
   - **Scopes**: Select required scopes

</Tab>
</Tabs>

</Step>

<Step>

### Copy Credentials

After creating the application:
1. Copy the **Application ID** (Client ID)
2. Copy the **Secret** (Client Secret)
3. Note your GitLab instance URL (for self-hosted)

</Step>

<Step>

### Environment Variables

<Tabs>
<Tab value="gitlab-com" label="GitLab.com">

```bash title=".env.local"
GITLAB_CLIENT_ID=your_gitlab_application_id
GITLAB_CLIENT_SECRET=your_gitlab_secret
```

</Tab>

<Tab value="self-hosted" label="Self-Hosted GitLab">

```bash title=".env.local"
GITLAB_CLIENT_ID=your_gitlab_application_id
GITLAB_CLIENT_SECRET=your_gitlab_secret
GITLAB_URL=https://gitlab.yourcompany.com
```

</Tab>
</Tabs>

</Step>

<Step>

### Configure Keyloom

<Tabs>
<Tab value="gitlab-com" label="GitLab.com">

```typescript title="keyloom.config.ts"
import { defineKeyloom } from "@keyloom/core";
import gitlab from "@keyloom/providers/gitlab";

export default defineKeyloom({
  // ... other config
  providers: [
    gitlab({
      clientId: process.env.GITLAB_CLIENT_ID!,
      clientSecret: process.env.GITLAB_CLIENT_SECRET!,
    }),
  ],
});
```

</Tab>

<Tab value="self-hosted" label="Self-Hosted GitLab">

```typescript title="keyloom.config.ts"
import { defineKeyloom } from "@keyloom/core";
import gitlab from "@keyloom/providers/gitlab";

export default defineKeyloom({
  // ... other config
  providers: [
    gitlab({
      clientId: process.env.GITLAB_CLIENT_ID!,
      clientSecret: process.env.GITLAB_CLIENT_SECRET!,
      baseUrl: process.env.GITLAB_URL!, // Your GitLab instance
    }),
  ],
});
```

</Tab>
</Tabs>

</Step>
</Steps>

## Configuration Options

```typescript
interface GitLabProviderOptions {
  /** GitLab application ID */
  clientId: string;
  /** GitLab application secret */
  clientSecret: string;
  /** GitLab instance URL (default: 'https://gitlab.com') */
  baseUrl?: string;
  /** Custom scopes (default: 'read_user') */
  scope?: string;
}
```

## User Profile

The GitLab provider returns the following user information:

```typescript
interface GitLabProfile {
  id: string;           // GitLab user ID
  email: string | null; // User's email address
  name: string | null;  // User's display name
  image: string | null; // Avatar URL
  username?: string;    // GitLab username
}
```

## Scopes

Common GitLab OAuth scopes:

### Basic Scopes
- `read_user` - Read user profile information (default)
- `read_repository` - Read repository information
- `write_repository` - Write to repositories
- `read_registry` - Read container registry

### Advanced Scopes
- `api` - Full API access
- `read_api` - Read-only API access
- `openid` - OpenID Connect support
- `profile` - User profile information
- `email` - User email address

### Custom Scopes

```typescript
gitlab({
  clientId: process.env.GITLAB_CLIENT_ID!,
  clientSecret: process.env.GITLAB_CLIENT_SECRET!,
  scope: "read_user read_repository write_repository",
});
```

## GitLab API Integration

After authentication, use the access token for GitLab API calls:

```typescript
// Example: Get user's projects
async function getUserProjects(accessToken: string, baseUrl = 'https://gitlab.com') {
  const response = await fetch(`${baseUrl}/api/v4/projects?membership=true`, {
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
    },
  });
  
  return response.json();
}

// Example: Get user profile
async function getUserProfile(accessToken: string, baseUrl = 'https://gitlab.com') {
  const response = await fetch(`${baseUrl}/api/v4/user`, {
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
  });
  
  return response.json();
}

// Example: Create a new project
async function createProject(accessToken: string, projectData: any, baseUrl = 'https://gitlab.com') {
  const response = await fetch(`${baseUrl}/api/v4/projects`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(projectData),
  });
  
  return response.json();
}
```

## Self-Hosted GitLab Configuration

### Custom Domain Setup

For self-hosted GitLab instances:

```typescript
gitlab({
  clientId: process.env.GITLAB_CLIENT_ID!,
  clientSecret: process.env.GITLAB_CLIENT_SECRET!,
  baseUrl: "https://gitlab.yourcompany.com",
});
```

### SSL Configuration

For self-hosted instances with custom SSL:

```typescript
// If using self-signed certificates in development
process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0'; // Only for development!

gitlab({
  clientId: process.env.GITLAB_CLIENT_ID!,
  clientSecret: process.env.GITLAB_CLIENT_SECRET!,
  baseUrl: "https://gitlab.internal.company.com",
});
```

### Enterprise Features

GitLab Enterprise Edition features:
- **SAML SSO**: Integrate with enterprise identity providers
- **LDAP Integration**: Connect with LDAP directories
- **Advanced Security**: Security scanning and compliance features
- **Audit Events**: Comprehensive audit logging

## Advanced Usage

### Multiple GitLab Instances

Support multiple GitLab instances:

```typescript
import { createOAuthProvider } from "@keyloom/providers/factory";

const gitlabCom = gitlab({
  clientId: process.env.GITLAB_COM_CLIENT_ID!,
  clientSecret: process.env.GITLAB_COM_CLIENT_SECRET!,
});

const gitlabEnterprise = createOAuthProvider({
  id: "gitlab-enterprise",
  authorizationUrl: "https://gitlab.company.com/oauth/authorize",
  tokenUrl: "https://gitlab.company.com/oauth/token",
  userinfoUrl: "https://gitlab.company.com/api/v4/user",
  scopes: ["read_user"],
  // ... other config
});
```

### Custom User Mapping

Customize user profile mapping:

```typescript
import { createOAuthProvider } from "@keyloom/providers/factory";

const customGitlab = createOAuthProvider({
  id: "gitlab",
  authorizationUrl: "https://gitlab.com/oauth/authorize",
  tokenUrl: "https://gitlab.com/oauth/token",
  userinfoUrl: "https://gitlab.com/api/v4/user",
  scopes: ["read_user"],
  mapProfile: (profile) => ({
    id: String(profile.id),
    email: profile.email,
    name: profile.name || profile.username,
    image: profile.avatar_url,
    username: profile.username, // Additional field
    location: profile.location,  // Additional field
  }),
});
```

## Troubleshooting

### Common Issues

**Invalid Redirect URI**
- Ensure redirect URI exactly matches GitLab application configuration
- Check for trailing slashes and correct protocol
- Verify the format: `/api/auth/callback/gitlab`

**SSL Certificate Issues (Self-Hosted)**
- Verify SSL certificates are properly configured
- Check certificate chain and intermediate certificates
- For development, consider using valid certificates or proper SSL setup

**Scope Permission Errors**
- Verify requested scopes are enabled in GitLab application
- Check user permissions for requested resources
- Some scopes require admin approval in enterprise instances

**API Rate Limiting**
- GitLab has rate limits on API endpoints
- Implement proper error handling for 429 responses
- Consider caching frequently accessed data

### Testing

Test your GitLab integration:

1. **GitLab Application**: Test OAuth flow in GitLab application settings
2. **API Access**: Verify API calls work with obtained tokens
3. **Different Scopes**: Test with various scope combinations
4. **Self-Hosted**: Test connectivity to self-hosted instances

<Callout>
For self-hosted GitLab instances, ensure your application can reach the GitLab server and that SSL certificates are properly configured.
</Callout>

## Security Best Practices

- **Client Secret**: Store securely and rotate regularly
- **Scope Minimization**: Request only necessary permissions
- **Token Storage**: Store access tokens securely
- **HTTPS**: Always use HTTPS for production
- **Network Security**: Secure network access to self-hosted instances

## Migration from GitLab OAuth

When migrating from direct GitLab OAuth integration:

1. **Token Migration**: Update token handling to use Keyloom format
2. **API Calls**: Update API calls to use new token structure
3. **User Mapping**: Ensure user identity mapping is consistent
4. **Scope Updates**: Review and update required scopes

## Resources

- [GitLab OAuth Documentation](https://docs.gitlab.com/ee/api/oauth2.html)
- [GitLab API Documentation](https://docs.gitlab.com/ee/api/)
- [GitLab Application Settings](https://gitlab.com/-/profile/applications)
- [GitLab Self-Hosted Installation](https://about.gitlab.com/install/)
- [GitLab Enterprise Edition](https://about.gitlab.com/pricing/)
