---
title: X (Twitter) Provider
description: Configure X (formerly Twitter) OAuth with Keyloom for social authentication and API access.
---

import { Callout } from "fumadocs-ui/components/callout";
import { Steps, Step } from "fumadocs-ui/components/steps";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";

# X (Twitter) Provider

The X provider enables OAuth authentication using X (formerly Twitter) accounts. Perfect for social media applications, content platforms, and any app targeting X users.

## Features

- **OAuth 2.0 with PKCE**: Modern OAuth 2.0 implementation
- **X API Access**: Access to X API v2 endpoints
- **User Profile**: Get user profile information and avatar
- **Scope Control**: Fine-grained permission control
- **Rate Limiting**: Built-in rate limit handling

<Callout type="info">
  X has transitioned from OAuth 1.0a to OAuth 2.0 with PKCE. This provider uses
  the modern OAuth 2.0 implementation.
</Callout>

## Setup

<Steps>
<Step>

### Create X Developer Account

1. Apply for a [X Developer Account](https://developer.twitter.com/en/apply-for-access)
2. Wait for approval (can take several days)
3. Access the [X Developer Portal](https://developer.twitter.com/en/portal/dashboard)

</Step>

<Step>

### Create X App

1. In the Developer Portal, click "Create App"
2. Choose your app environment (Development/Production)
3. Configure your app:
   - **App Name**: Your application name
   - **Description**: Brief description of your app
   - **Website URL**: Your website URL
   - **Callback URLs**: `https://yourdomain.com/api/auth/callback/x`

</Step>

<Step>

### Configure OAuth 2.0

1. Go to your app settings
2. Navigate to "Authentication settings"
3. Enable "OAuth 2.0"
4. Set callback URL: `https://yourdomain.com/api/auth/callback/x`
5. For local development: `http://localhost:3000/api/auth/callback/x`

</Step>

<Step>

### Get Credentials

1. Go to "Keys and tokens" tab
2. Copy your **Client ID** and **Client Secret**
3. Note: X uses OAuth 2.0 with PKCE, so client secret is optional for public clients

</Step>

<Step>

### Environment Variables

Add your X credentials:

```bash title=".env.local"
X_CLIENT_ID=your_x_client_id
X_CLIENT_SECRET=your_x_client_secret
```

</Step>

<Step>

### Configure Keyloom

```typescript title="keyloom.config.ts"
import { defineKeyloom } from "@keyloom/core";
import x from "@keyloom/providers/x";

export default defineKeyloom({
  // ... other config
  providers: [
    x({
      clientId: process.env.X_CLIENT_ID!,
      clientSecret: process.env.X_CLIENT_SECRET!,
    }),
  ],
});
```

</Step>
</Steps>

## Configuration Options

```typescript
interface XProviderOptions {
  /** X application client ID */
  clientId: string;
  /** X application client secret */
  clientSecret: string;
  /** Custom scopes (default: 'tweet.read users.read') */
  scope?: string;
}
```

## User Profile

The X provider returns the following user information:

```typescript
interface XProfile {
  id: string; // X user ID
  email: string | null; // User's email (if granted)
  name: string | null; // User's display name
  image: string | null; // Profile picture URL
  username?: string; // X username (handle)
  verified?: boolean; // Verification status
}
```

## Scopes

X OAuth 2.0 scopes for API access:

### Basic Scopes

- `tweet.read` - Read tweets
- `users.read` - Read user profile information
- `follows.read` - Read following/followers information
- `offline.access` - Refresh token access

### Advanced Scopes

- `tweet.write` - Post tweets
- `tweet.moderate.write` - Moderate tweets (hide replies, etc.)
- `follows.write` - Follow/unfollow users
- `space.read` - Read Spaces information
- `mute.read` - Read muted accounts
- `mute.write` - Mute/unmute accounts
- `like.read` - Read liked tweets
- `like.write` - Like/unlike tweets
- `list.read` - Read lists
- `list.write` - Create/manage lists
- `bookmark.read` - Read bookmarks
- `bookmark.write` - Create/manage bookmarks

### Custom Scopes

```typescript
x({
  clientId: process.env.X_CLIENT_ID!,
  clientSecret: process.env.X_CLIENT_SECRET!,
  scope: "tweet.read users.read tweet.write follows.read offline.access",
});
```

## X API Integration

After authentication, use the access token for X API v2 calls:

```typescript
// Example: Get user's profile
async function getUserProfile(accessToken: string, userId: string) {
  const response = await fetch(`https://api.twitter.com/2/users/${userId}`, {
    headers: {
      Authorization: `Bearer ${accessToken}`,
      "Content-Type": "application/json",
    },
  });

  return response.json();
}

// Example: Get user's tweets
async function getUserTweets(accessToken: string, userId: string) {
  const response = await fetch(
    `https://api.twitter.com/2/users/${userId}/tweets?max_results=10`,
    {
      headers: {
        Authorization: `Bearer ${accessToken}`,
      },
    }
  );

  return response.json();
}

// Example: Post a tweet
async function postTweet(accessToken: string, text: string) {
  const response = await fetch("https://api.twitter.com/2/tweets", {
    method: "POST",
    headers: {
      Authorization: `Bearer ${accessToken}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ text }),
  });

  return response.json();
}

// Example: Follow a user
async function followUser(
  accessToken: string,
  userId: string,
  targetUserId: string
) {
  const response = await fetch(
    `https://api.twitter.com/2/users/${userId}/following`,
    {
      method: "POST",
      headers: {
        Authorization: `Bearer ${accessToken}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ target_user_id: targetUserId }),
    }
  );

  return response.json();
}
```

## Advanced Usage

### Rate Limit Handling

X API has rate limits. Handle them properly:

```typescript
async function makeXAPICall(accessToken: string, url: string) {
  const response = await fetch(url, {
    headers: {
      Authorization: `Bearer ${accessToken}`,
    },
  });

  if (response.status === 429) {
    // Rate limited
    const resetTime = response.headers.get("x-rate-limit-reset");
    const waitTime = parseInt(resetTime!) * 1000 - Date.now();

    // Wait until rate limit resets
    await new Promise((resolve) => setTimeout(resolve, waitTime));

    // Retry the request
    return makeXAPICall(accessToken, url);
  }

  return response.json();
}
```

### Webhook Integration

Set up webhooks for real-time events:

```typescript
// Example webhook handler for X events
export async function POST(request: Request) {
  const signature = request.headers.get("x-twitter-webhooks-signature");
  const body = await request.text();

  // Verify webhook signature
  if (!verifyWebhookSignature(body, signature)) {
    return new Response("Unauthorized", { status: 401 });
  }

  const event = JSON.parse(body);

  // Handle different event types
  switch (event.event_type) {
    case "tweet_create":
      await handleTweetCreate(event);
      break;
    case "follow":
      await handleFollow(event);
      break;
    // ... other events
  }

  return new Response("OK");
}
```

### Custom User Fields

Request additional user fields:

```typescript
async function getUserWithFields(accessToken: string, userId: string) {
  const fields = [
    "created_at",
    "description",
    "location",
    "pinned_tweet_id",
    "profile_image_url",
    "protected",
    "public_metrics",
    "url",
    "verified",
    "verified_type",
  ].join(",");

  const response = await fetch(
    `https://api.twitter.com/2/users/${userId}?user.fields=${fields}`,
    {
      headers: {
        Authorization: `Bearer ${accessToken}`,
      },
    }
  );

  return response.json();
}
```

## Migration from Twitter API v1.1

Key differences when migrating from v1.1:

### Authentication

- **v1.1**: OAuth 1.0a with signature-based authentication
- **v2**: OAuth 2.0 with Bearer tokens (simpler)

### Endpoints

- **v1.1**: `/1.1/users/show.json`
- **v2**: `/2/users/:id` or `/2/users/by/username/:username`

### Response Format

- **v1.1**: Flat JSON structure
- **v2**: Structured with `data` and `includes` objects

### Rate Limits

- **v1.1**: Per-endpoint rate limits
- **v2**: More granular rate limiting with different windows

## Troubleshooting

### Common Issues

**Invalid Callback URL**

- Ensure callback URL exactly matches X app configuration
- Check for trailing slashes and correct protocol
- Verify the format: `/api/auth/callback/x`

**Scope Permission Errors**

- Verify requested scopes are enabled in your X app
- Some scopes require app approval from X
- Check if your app has the necessary access level

**Rate Limit Exceeded**

- Implement proper rate limit handling
- Use exponential backoff for retries
- Monitor your API usage in the developer portal

**App Suspended**

- Check X Developer Portal for suspension notices
- Review X Developer Policy compliance
- Contact X Developer Support if needed

### Testing

Test your X integration:

1. **Developer Portal**: Use the API testing tools
2. **Postman**: Test API endpoints with your tokens
3. **Development**: Test OAuth flow with localhost
4. **Production**: Verify with production domain

<Callout>
  X requires HTTPS for production callback URLs. Ensure your production
  environment has valid SSL certificates.
</Callout>

## X Developer Policies

Important policies to follow:

- **Automation Rules**: Don't spam or automate excessively
- **Content Policy**: Respect X's content guidelines
- **Rate Limits**: Don't exceed API rate limits
- **User Privacy**: Respect user privacy and data
- **Terms of Service**: Follow X's Terms of Service

## Security Best Practices

- **Client Secret**: Store securely and rotate regularly
- **Scope Minimization**: Request only necessary permissions
- **Token Storage**: Store access tokens securely
- **HTTPS**: Always use HTTPS for production
- **Webhook Security**: Verify webhook signatures

## Resources

- [X Developer Portal](https://developer.twitter.com/en/portal/dashboard)
- [X API v2 Documentation](https://developer.twitter.com/en/docs/twitter-api)
- [X OAuth 2.0 Guide](https://developer.twitter.com/en/docs/authentication/oauth-2-0)
- [X Developer Policies](https://developer.twitter.com/en/developer-terms)
- [X API Rate Limits](https://developer.twitter.com/en/docs/twitter-api/rate-limits)
