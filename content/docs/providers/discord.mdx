---
title: Discord Provider
description: Configure Discord OAuth with Keyloom for seamless authentication.
---

import { Callout } from "fumadocs-ui/components/callout";
import { Steps, Step } from "fumadocs-ui/components/steps";

# Discord Provider

The Discord provider enables OAuth authentication using Discord accounts. Perfect for gaming applications, community platforms, and any app targeting Discord users.

## Features

- **OAuth 2.0 Flow**: Secure Discord authentication
- **User Profile Access**: Get Discord user information and avatar
- **Scope Control**: Configure Discord permissions
- **TypeScript Support**: Full type safety

## Setup

<Steps>
<Step>

### Create Discord Application

1. Go to the [Discord Developer Portal](https://discord.com/developers/applications)
2. Click "New Application" and give it a name
3. Navigate to the "OAuth2" section in the sidebar
4. Copy your **Client ID** and **Client Secret**

</Step>

<Step>

### Configure Redirect URI

In your Discord application's OAuth2 settings, add your callback URL:

```
https://yourdomain.com/api/auth/callback/discord
```

For local development:

```
http://localhost:3000/api/auth/callback/discord
```

</Step>

<Step>

### Environment Variables

Add your Discord credentials to your environment file:

```bash title=".env.local"
DISCORD_CLIENT_ID=your_discord_client_id
DISCORD_CLIENT_SECRET=your_discord_client_secret
```

</Step>

<Step>

### Configure Keyloom

```typescript title="keyloom.config.ts"
import { defineKeyloom } from "@keyloom/core";
import discord from "@keyloom/providers/discord";

export default defineKeyloom({
  // ... other config
  providers: [
    discord({
      clientId: process.env.DISCORD_CLIENT_ID!,
      clientSecret: process.env.DISCORD_CLIENT_SECRET!,
    }),
  ],
});
```

</Step>
</Steps>

## Configuration Options

```typescript
interface DiscordProviderOptions {
  /** Discord application client ID */
  clientId: string;
  /** Discord application client secret */
  clientSecret: string;
}
```

## User Profile

The Discord provider returns the following user information:

```typescript
interface DiscordProfile {
  id: string; // Discord user ID
  email: string | null; // User's email (if granted)
  name: string | null; // Display name or username
  image: string | null; // Avatar URL
}
```

## Scopes

The Discord provider requests these scopes by default:

- `identify` - Access to user's Discord tag, avatar, and other basic info
- `email` - Access to user's email address

## Discord API Details

### Authorization URL

```
https://discord.com/api/oauth2/authorize
```

### Token URL

```
https://discord.com/api/oauth2/token
```

### User Info URL

```
https://discord.com/api/users/@me
```

## Advanced Usage

### Custom Scopes

If you need additional Discord permissions, you can customize the provider:

```typescript
import { createOAuthProvider } from "@keyloom/providers/factory";

const customDiscord = createOAuthProvider({
  id: "discord",
  authorizationUrl: "https://discord.com/api/oauth2/authorize",
  tokenUrl: "https://discord.com/api/oauth2/token",
  userinfoUrl: "https://discord.com/api/users/@me",
  scopes: ["identify", "email", "guilds"], // Add guilds scope
  tokenStyle: "form",
  mapProfile: (raw) => ({
    id: raw.id,
    email: raw.email ?? null,
    name: raw.global_name ?? raw.username ?? null,
    image: raw.avatar
      ? `https://cdn.discordapp.com/avatars/${raw.id}/${raw.avatar}.png`
      : null,
  }),
});
```

### Guild Information

To access user's Discord servers, add the `guilds` scope:

```typescript
// This requires custom implementation as shown above
const discordWithGuilds = customDiscord({
  clientId: process.env.DISCORD_CLIENT_ID!,
  clientSecret: process.env.DISCORD_CLIENT_SECRET!,
  // Additional scopes will be handled by the custom provider
});
```

## Troubleshooting

### Common Issues

**Invalid Redirect URI**

- Ensure your redirect URI exactly matches what's configured in Discord
- Check for trailing slashes and protocol (http vs https)
- Verify the callback URL format: `/api/auth/callback/discord`

**Missing Email**

- Email is only provided if the user grants the `email` scope
- Some Discord users may not have verified email addresses
- Handle null email values in your application

**Avatar Issues**

- Discord avatars are served from Discord's CDN
- URLs may change if users update their avatars
- Consider caching or re-fetching avatar URLs periodically

**Rate Limiting**

- Discord has rate limits on their OAuth endpoints
- Implement proper error handling for 429 responses
- Consider implementing exponential backoff for retries

### Testing

Test your Discord integration:

1. **Development**: Use `http://localhost:3000/api/auth/callback/discord`
2. **Production**: Ensure HTTPS is used for the callback URL
3. **User Flow**: Test the complete OAuth flow with a Discord account

<Callout>
  Discord requires HTTPS for production callback URLs. Make sure your production
  environment uses SSL certificates.
</Callout>

## Discord Bot Integration

If you're building a Discord bot alongside your web app, you can use the same Discord application:

1. Enable the "Bot" section in your Discord application
2. Use the bot token for Discord API calls
3. The OAuth credentials remain separate from the bot token

<Callout type="info">
  OAuth tokens and bot tokens serve different purposes. OAuth tokens
  authenticate users, while bot tokens authenticate your application as a bot.
</Callout>

## Security Considerations

- **Client Secret**: Keep your Discord client secret secure and never expose it in client-side code
- **Scope Minimization**: Only request the Discord scopes your application actually needs
- **Token Storage**: Store Discord tokens securely and follow Discord's terms of service
- **User Privacy**: Respect user privacy and Discord's data usage policies

## Resources

- [Discord Developer Portal](https://discord.com/developers/applications)
- [Discord OAuth2 Documentation](https://discord.com/developers/docs/topics/oauth2)
- [Discord API Reference](https://discord.com/developers/docs/reference)
- [Discord Developer Terms of Service](https://discord.com/developers/docs/legal)
