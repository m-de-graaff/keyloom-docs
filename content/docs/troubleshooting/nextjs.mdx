---
title: Next.js Troubleshooting
description: Resolve integration issues in the App Router.
---

# Next.js Troubleshooting

## Middleware not running
- Ensure `export default createAuthMiddleware(config, { routes })` in `middleware.ts`
- The file must be at the project root

## Server helpers throw "Keyloom config not provided"
- Pass your config explicitly: `getSession(config)` / `guard(rule, config)`

## Route annotations not detected
- Re-run `npx keyloom routes` after changing visibility annotations
- Ensure the generated file is imported in `middleware.ts`

## JWT session appears null
- Verify `KEYLOOM_JWT_JWKS_URL` and `KEYLOOM_JWT_ISSUER`
- If behind a proxy, confirm cookies are forwarded and not stripped

